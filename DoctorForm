package HospitalManagementSystem;

import javax.swing.*;
import java.awt.*;
import java.io.FileWriter;
import java.io.PrintWriter;

public class DoctorForm extends JFrame {

    private static final long serialVersionUID = 1L;
    private JTextArea txtPatientList;
    private JComboBox<String> cmbAvailability;
    private JLabel lblStatus;
    private String doctorName;

    public DoctorForm(String username) {
        this.doctorName = username;
        
        setTitle("Doctor Portal - Dr. " + username);
        setSize(600, 600);
        getContentPane().setLayout(null);
        setDefaultCloseOperation(EXIT_ON_CLOSE);

        // Welcome message
        JLabel lblWelcome = new JLabel("Welcome, Dr. " + username + "!");
        lblWelcome.setFont(new Font("Tahoma", Font.BOLD, 16));
        lblWelcome.setBounds(30, 10, 400, 30);
        getContentPane().add(lblWelcome);

        // Availability Section
        JLabel lblAvailabilityTitle = new JLabel("Set Your Availability");
        lblAvailabilityTitle.setFont(new Font("Tahoma", Font.BOLD, 14));
        lblAvailabilityTitle.setBounds(30, 50, 250, 25);
        getContentPane().add(lblAvailabilityTitle);

        JLabel lblAvailability = new JLabel("Status:");
        lblAvailability.setBounds(30, 85, 100, 25);
        getContentPane().add(lblAvailability);

        String[] availabilityOptions = {"Available", "Busy", "Off Duty", "On Call"};
        cmbAvailability = new JComboBox<>(availabilityOptions);
        cmbAvailability.setBounds(140, 85, 200, 25);
        getContentPane().add(cmbAvailability);

        JButton btnUpdateStatus = new JButton("Update Status");
        btnUpdateStatus.setBounds(350, 85, 150, 25);
        getContentPane().add(btnUpdateStatus);
        btnUpdateStatus.addActionListener(e -> updateAvailability());

        lblStatus = new JLabel("Current Status: Available");
        lblStatus.setFont(new Font("Tahoma", Font.BOLD, 12));
        lblStatus.setForeground(new Color(0, 128, 0));
        lblStatus.setBounds(30, 120, 300, 25);
        getContentPane().add(lblStatus);

        // Statistics Panel
        JPanel statsPanel = new JPanel();
        statsPanel.setBackground(new Color(240, 248, 255));
        statsPanel.setBorder(BorderFactory.createTitledBorder("Today's Statistics"));
        statsPanel.setBounds(30, 160, 530, 80);
        statsPanel.setLayout(null);
        getContentPane().add(statsPanel);

        JLabel lblTotalPatients = new JLabel("Total Appointments: 0");
        lblTotalPatients.setFont(new Font("Tahoma", Font.PLAIN, 12));
        lblTotalPatients.setBounds(20, 25, 200, 20);
        statsPanel.add(lblTotalPatients);

        JLabel lblPendingPatients = new JLabel("Today's Patients: 0");
        lblPendingPatients.setFont(new Font("Tahoma", Font.PLAIN, 12));
        lblPendingPatients.setBounds(20, 50, 200, 20);
        statsPanel.add(lblPendingPatients);

        // Patient List Section
        JLabel lblPatients = new JLabel("Your Patients & Appointments:");
        lblPatients.setFont(new Font("Tahoma", Font.BOLD, 14));
        lblPatients.setBounds(30, 260, 300, 25);
        getContentPane().add(lblPatients);

        JButton btnRefresh = new JButton("Refresh");
        btnRefresh.setBounds(380, 260, 100, 25);
        getContentPane().add(btnRefresh);
        btnRefresh.addActionListener(e -> updatePatientList());

        JButton btnExport = new JButton("Export");
        btnExport.setBounds(490, 260, 70, 25);
        getContentPane().add(btnExport);
        btnExport.addActionListener(e -> exportPatientList());

        txtPatientList = new JTextArea();
        txtPatientList.setEditable(false);
        txtPatientList.setFont(new Font("Monospaced", Font.PLAIN, 11));
        
        JScrollPane scrollPane = new JScrollPane(txtPatientList);
        scrollPane.setBounds(30, 295, 530, 250);
        getContentPane().add(scrollPane);

        // Load patient list
        updatePatientList();
    }

    private void updateAvailability() {
        String status = (String) cmbAvailability.getSelectedItem();
        lblStatus.setText("Current Status: " + status);
        
        // Set color based on status
        switch (status) {
            case "Available":
                lblStatus.setForeground(new Color(0, 128, 0));
                break;
            case "Busy":
                lblStatus.setForeground(new Color(255, 140, 0));
                break;
            case "Off Duty":
                lblStatus.setForeground(new Color(255, 0, 0));
                break;
            case "On Call":
                lblStatus.setForeground(new Color(0, 0, 255));
                break;
        }
        
        JOptionPane.showMessageDialog(this, 
            "Your availability status has been updated to: " + status,
            "Status Updated", 
            JOptionPane.INFORMATION_MESSAGE);
    }

    private void updatePatientList() {
        StringBuilder sb = new StringBuilder();
        sb.append("PATIENTS SCHEDULED WITH DR. ").append(doctorName.toUpperCase()).append("\n");
        sb.append("=".repeat(70)).append("\n\n");
        
        int count = 0;
        for (int i = 0; i < HospitalSystemClass.appointments.size(); i++) {
            Appointment apt = HospitalSystemClass.appointments.get(i);
            
            if (apt.getDoctor().getName().equalsIgnoreCase(doctorName)) {
                count++;
                sb.append(count).append(". Patient: ").append(apt.getPatient().getName()).append("\n");
                sb.append("   Patient ID: ").append(apt.getPatient().getId()).append("\n");
                sb.append("   Appointment: ").append(apt.getDate()).append("\n");
                sb.append("   ").append("-".repeat(60)).append("\n");
            }
        }
        
        if (count == 0) {
            sb.append("No patients scheduled yet.\n");
            sb.append("Waiting for appointments...\n");
        } else {
            sb.append("\n").append("=".repeat(70)).append("\n");
            sb.append("TOTAL PATIENTS: ").append(count).append("\n");
        }
        
        txtPatientList.setText(sb.toString());
    }

    private void exportPatientList() {
        try {
            JFileChooser fileChooser = new JFileChooser();
            fileChooser.setDialogTitle("Export Patient List");
            fileChooser.setSelectedFile(new java.io.File("Dr_" + doctorName + "_Patients.txt"));
            
            int userSelection = fileChooser.showSaveDialog(this);
            
            if (userSelection == JFileChooser.APPROVE_OPTION) {
                String filePath = fileChooser.getSelectedFile().getAbsolutePath();
                if (!filePath.endsWith(".txt")) {
                    filePath += ".txt";
                }

                PrintWriter writer = new PrintWriter(new FileWriter(filePath));
                writer.println("========================================");
                writer.println("   PATIENT LIST - DR. " + doctorName.toUpperCase());
                writer.println("========================================");
                writer.println();

                int count = 0;
                for (int i = 0; i < HospitalSystemClass.appointments.size(); i++) {
                    Appointment apt = HospitalSystemClass.appointments.get(i);
                    if (apt.getDoctor().getName().equalsIgnoreCase(doctorName)) {
                        count++;
                        writer.println(count + ". Patient: " + apt.getPatient().getName());
                        writer.println("   Patient ID: " + apt.getPatient().getId());
                        writer.println("   Appointment: " + apt.getDate());
                        writer.println();
                    }
                }

                writer.println("========================================");
                writer.println("Total Patients: " + count);
                writer.close();

                JOptionPane.showMessageDialog(this, "Patient list exported successfully!", 
                                            "Success", JOptionPane.INFORMATION_MESSAGE);
            }
        } catch (Exception ex) {
            JOptionPane.showMessageDialog(this, "Error exporting file: " + ex.getMessage(), 
                                        "Error", JOptionPane.ERROR_MESSAGE);
        }
    }

    public static void main(String[] args) {
        new DoctorForm("TestDoctor").setVisible(true);
    }
}
