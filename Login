package HospitalManagementSystem;

import java.util.ArrayList;
import java.awt.*;
import javax.swing.*;

public class Login {

    private static JTextField txtUsername;
    private static JPasswordField txtPassword;

    // User storage (username, password, role)
    private static class User {
        String username;
        String password;
        String role;

        User(String u, String p, String r) {
            username = u;
            password = p;
            role = r;
        }
    }

    private static ArrayList<User> users = new ArrayList<>();

    public static void main(String[] args) {

        // Sample pre-registered users
        users.add(new User("Ash", "ash", "Doctor"));
        users.add(new User("Tricia", "tricia", "Doctor"));
        users.add(new User("Jean", "jean", "Doctor"));
        users.add(new User("Patient1", "patient1", "Patient"));
        users.add(new User("Patient2", "patient2", "Patient"));
       
        JFrame frame = new JFrame("Hospital Login");
        frame.setIconImage(Toolkit.getDefaultToolkit().getImage("C:\\Users\\Owner\\eclipse-workspace\\HospitalManagementSystem\\image\\Hospital.png."));
        frame.setSize(450, 290);
        frame.getContentPane().setLayout(null);
        frame.setLocationRelativeTo(null);

        JLabel lblUsername = new JLabel("Username:");
        lblUsername.setBounds(55, 56, 79, 14);
        frame.getContentPane().add(lblUsername);

        txtUsername = new JTextField();
        txtUsername.setBounds(128, 53, 280, 20);
        frame.getContentPane().add(txtUsername);

        JLabel lblPassword = new JLabel("Password:");
        lblPassword.setBounds(55, 97, 79, 14);
        frame.getContentPane().add(lblPassword);

        txtPassword = new JPasswordField();
        txtPassword.setBounds(128, 94, 280, 20);
        frame.getContentPane().add(txtPassword);

        // LOGIN BUTTON
        JButton btnLogin = new JButton("Login");
        btnLogin.setForeground(new Color(255, 255, 255));
        btnLogin.setBackground(new Color(0, 0, 128));
        btnLogin.setBounds(140, 140, 90, 25);
        frame.getContentPane().add(btnLogin);

        // REGISTER BUTTON
        JButton btnRegister = new JButton("Cancel");
        btnRegister.setForeground(new Color(255, 255, 255));
        btnRegister.setBackground(new Color(128, 0, 0));
        btnRegister.setBounds(250, 140, 90, 25);
        frame.getContentPane().add(btnRegister);
        

        // LOGIN ACTION
        btnLogin.addActionListener(e -> {
            String username = txtUsername.getText();
            String password = String.valueOf(txtPassword.getPassword());
            boolean found = false;

            for (User u : users) {
                if (u.username.equals(username) && u.password.equals(password)) {
                    found = true;
                    JOptionPane.showMessageDialog(frame,
                            "Login Successful!\nWelcome " + u.role + ": " + u.username);
                    
                    // Close login window and open appropriate portal
                    frame.dispose();
                    
                    try {
                        if (u.role.equals("Doctor")) {
                            DoctorForm doctorWindow = new DoctorForm(u.username);
                            doctorWindow.setVisible(true);
                        } else {
                            PatientForm patientWindow = new PatientForm(u.username);
                            patientWindow.setVisible(true);
                        }
                    } catch (Exception ex) {
                        ex.printStackTrace();
                        JOptionPane.showMessageDialog(null, 
                            "Error opening portal: " + ex.getMessage());
                    }
                    break;
                }
            }

            if (!found) {
                JOptionPane.showMessageDialog(frame,
                        "Invalid username or password",
                        "Error",
                        JOptionPane.ERROR_MESSAGE);
            }
        });

        // REGISTER ACTION
        btnRegister.addActionListener(e -> {
            String username = txtUsername.getText();
            String password = String.valueOf(txtPassword.getPassword());

            if (username.isEmpty() || password.isEmpty()) {
                JOptionPane.showMessageDialog(frame,
                        "Please enter username and password",
                        "Error",
                        JOptionPane.ERROR_MESSAGE);
                return;
            }

            // Check if username already exists
            for (User u : users) {
                if (u.username.equals(username)) {
                    JOptionPane.showMessageDialog(frame,
                            "Username already exists!",
                            "Error",
                            JOptionPane.ERROR_MESSAGE);
                    return;
                }
            }

            // Ask role
            String[] roles = {"Doctor", "Patient"};
            String role = (String) JOptionPane.showInputDialog(frame,
                    "Select your role",
                    "Role Selection",
                    JOptionPane.QUESTION_MESSAGE,
                    null,
                    roles,
                    roles[0]);

            if (role == null) return; // User cancelled

            users.add(new User(username, password, role));

            JOptionPane.showMessageDialog(frame,
                    role + " registered successfully!\nUsername: " + username);
            
            // Close login window and open appropriate portal
            frame.dispose();
            
            try {
                if (role.equals("Doctor")) {
                    DoctorForm doctorWindow = new DoctorForm(username);
                    doctorWindow.setVisible(true);
                } else {
                    PatientForm patientWindow = new PatientForm(username);
                    patientWindow.setVisible(true);
                }
            } catch (Exception ex) {
                ex.printStackTrace();
                JOptionPane.showMessageDialog(null, 
                    "Error opening portal: " + ex.getMessage());
            }
        });

        frame.setVisible(true);
    }

	private static Container getContentPane() {
		return null;
	}

	private static void setLocationRelativeTo(Object object) {
		
	}
}
